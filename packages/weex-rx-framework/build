#!/usr/bin/env sh

# Example: ./build -n tnpm -b

# Reset in case getopts has been used previously in the shell.
OPTIND=1

# Initialize our own variables:
npm="npm"
install="link"
onlyBuild=0

while getopts "bln:" opt; do
  case "$opt" in
    b) onlyBuild=1
    ;;
    l) install="link"
    ;;
    n) npm=$OPTARG
    ;;
  esac
done

shift $((OPTIND-1))

[ "$1" = "--" ] && shift

echo "Creates global weex-rx-framework link:"
$npm link

if [[ $onlyBuild == 1 ]]; then

  echo "Build without prerequisites:"
  cd weex

else

  echo "Clone the weex repository and install prerequisites:"
  git clone git@github.com:alibaba/weex.git --depth=1
  cd weex
  $npm install

fi

echo "Install/Link the weex-rx-framework of your dependency:"
$npm $install weex-rx-framework

echo "Config weex/html5/frameworks/index.js"
echo -e "import * as Weex from './legacy/index'\nimport Rx from 'weex-rx-framework'\nexport default {\n  Rx, Weex\n}" > html5/frameworks/index.js

echo "Build jsfm for native renderer to weex/dist/native.js"
$npm run build:native
